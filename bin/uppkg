#!/bin/bash

PKGDIR=${1:-}
PKGNAME=${2:-}

PKGDIR=$(realpath "${PKGDIR}")

if [ -z "${PKGDIR}" ]; then
    echo "You need to enter the full path to the package's directory."
fi


if [ -z "${PKGNAME}" ]; then
    echo "You need to enter a valid package name."
fi

TEMP="$(mktemp -d --tmpdir uppkg.XXXXX)"
pushd "${TEMP}"

git clone ssh://aur@aur4.archlinux.org/${PKGNAME}.git upstream
pushd upstream
rsync -av --progress "${PKGDIR}" "${TEMP}"/upstream --exclude=src --exclude=pkg --exclude="*.tar.*" --exclude="*.zip" --exclude="*.7z" --exclude="*.rar"
mksrcinfo
git add .
git commit -m "Update ${PKGNAME}"
git push origin master

echo "!!!DONE!!!"
